<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç­ç´šé»åç°¿</title>

  <style>
    :root{
      --pink:#ff6fae;
      --pink2:#ff9ac8;
      --peach:#ffb7a7;
      --mint:#7ee2c9;
      --lav:#cbb6ff;
      --sky:#a9d9ff;

      --primary:#ff5fa2;
      --success:#29b97a;
      --warning:#ff9f3d;
      --danger:#ff4d6d;
      --gray:#6b6b75;

      --card:#ffffffcc;
      --card2:#ffffffef;
      --line:#ffd2e4;
      --shadow: 0 14px 40px rgba(255, 111, 174, 0.18);
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: "Microsoft JhengHei", system-ui, -apple-system, Segoe UI, sans-serif;
      color:#3c4043;
      padding: 18px 12px;
      min-height:100vh;

      /* æ°´å¹³ç½®ä¸­ã€å‚ç›´é ä¸Š */
      display:flex;
      align-items:flex-start;
      justify-content:center;

      /* æ˜¥å­£èƒŒæ™¯ï¼šæŸ”å’Œæ¼¸å±¤ + èŠ±æœµå…‰æšˆ */
      background:
        radial-gradient(circle at 10% 12%, rgba(255, 182, 213, .65) 0 18%, transparent 19%),
        radial-gradient(circle at 85% 16%, rgba(169, 217, 255, .60) 0 18%, transparent 19%),
        radial-gradient(circle at 18% 80%, rgba(203, 182, 255, .55) 0 18%, transparent 19%),
        radial-gradient(circle at 80% 84%, rgba(126, 226, 201, .50) 0 18%, transparent 19%),
        linear-gradient(135deg, #fff0f6, #f6fbff 45%, #fff7ee);
      overflow-x:hidden;
      position:relative;
    }

    /* æ¼‚æµ®å°èŠ±é»é» */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.55;
      background-image:
        radial-gradient(circle, rgba(255,111,174,.25) 0 2px, transparent 3px),
        radial-gradient(circle, rgba(255,185,167,.25) 0 2px, transparent 3px),
        radial-gradient(circle, rgba(169,217,255,.25) 0 2px, transparent 3px);
      background-size: 120px 120px, 160px 160px, 200px 200px;
      background-position: 0 0, 40px 60px, 90px 30px;
      filter: blur(.2px);
    }

    /* é¡å¤–ï¼šå¤§èŠ±ç“£æ¼‚æµ®å±¤ï¼ˆæ˜¥å¤©æ„Ÿæ›´å¼·ï¼‰ */
    body::after{
      content:"";
      position:fixed;
      inset:-80px;
      pointer-events:none;
      opacity:.28;
      background-image:
        radial-gradient(circle at 20% 20%, rgba(255, 95, 162, .35) 0 10px, transparent 11px),
        radial-gradient(circle at 70% 30%, rgba(255, 180, 210, .35) 0 12px, transparent 13px),
        radial-gradient(circle at 35% 75%, rgba(169, 217, 255, .35) 0 12px, transparent 13px),
        radial-gradient(circle at 80% 80%, rgba(203, 182, 255, .35) 0 10px, transparent 11px);
      background-size: 260px 260px;
      animation: springFloat 9s ease-in-out infinite;
      filter: blur(.6px);
    }

    @keyframes springFloat{
      0%{ transform: translateY(0px); }
      50%{ transform: translateY(14px); }
      100%{ transform: translateY(0px); }
    }

    .card{
      width:min(580px, 100%);
      margin: 12px auto 24px;
      background: var(--card);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 210, 228, .85);
      padding: 22px 18px 18px;
      border-radius: 24px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }

    /* å¡ç‰‡ä¸Šæ–¹çš„èŠ±ç“£è£é£¾ */
    .card::before{
      content:"";
      position:absolute;
      top:-80px;
      right:-80px;
      width:200px;
      height:200px;
      background:
        radial-gradient(circle at 30% 35%, rgba(255,111,174,.35), transparent 55%),
        radial-gradient(circle at 65% 60%, rgba(203,182,255,.35), transparent 55%),
        radial-gradient(circle at 40% 70%, rgba(169,217,255,.28), transparent 55%);
      border-radius:50%;
      transform: rotate(18deg);
      pointer-events:none;
    }

    /* å·¦ä¸‹è§’å°èŠ±è£é£¾ */
    .card::after{
      content:"";
      position:absolute;
      bottom:-90px;
      left:-90px;
      width:220px;
      height:220px;
      background:
        radial-gradient(circle at 45% 45%, rgba(126,226,201,.25), transparent 55%),
        radial-gradient(circle at 55% 55%, rgba(255,183,167,.22), transparent 55%),
        radial-gradient(circle at 40% 70%, rgba(255,111,174,.18), transparent 55%);
      border-radius:50%;
      pointer-events:none;
      transform: rotate(-10deg);
    }

    h2{
      text-align:center;
      margin: 2px 0 14px;
      font-size: 26px;
      letter-spacing: .5px;
      color: #ff4f98;
      text-shadow: 0 8px 18px rgba(255, 95, 162, .18);
    }

    h2::before{
      content:"ğŸŒ¸";
      margin-right: 6px;
    }
    h2::after{
      content:"ğŸŒ¸";
      margin-left: 6px;
    }

    p{
      margin: 10px 0 12px;
      color: #555;
    }

    .section{
      background: var(--card2);
      padding: 14px 14px;
      border-radius: 18px;
      margin-bottom: 14px;
      border: 1px solid rgba(255, 210, 228, .9);
      box-shadow: 0 10px 20px rgba(255, 111, 174, .08);
      position:relative;
    }

    .btn-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    button{
      padding: 12px 12px;
      border: none;
      border-radius: 18px;
      cursor:pointer;
      font-weight: 900;
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
      position:relative;
      overflow:hidden;
      user-select:none;
    }

    button:active{
      transform: translateY(1px) scale(.99);
    }

    /* hover é£„èŠ±æ•ˆæœï¼ˆæ›´å¯æ„›ï¼šå¤šèŠ±ç“£ï¼‰ */
    button::after{
      content:"ğŸŒ¸";
      position:absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%) rotate(0deg);
      opacity: 0;
      transition: opacity .18s ease;
      filter: drop-shadow(0 6px 10px rgba(255, 95, 162, .25));
      pointer-events:none;
    }

    button::before{
      filter: drop-shadow(0 8px 12px rgba(255, 95, 162, .16));
    }

    button:hover{
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(255, 111, 174, .22);
      filter: brightness(1.03);
    }

    button:hover::after{
      opacity: 1;
      animation: floatPetal 1.2s ease-in-out infinite;
    }

    /* é¡å¤–ï¼šhover æ™‚é£„å‡ºå°èŠ±ç“£ç¢ç‰‡ */
    button:hover .petals{
      opacity: 1;
      animation: petalsBurst 1.2s ease-in-out infinite;
    }

    @keyframes floatPetal{
      0%{ transform: translateY(-50%) translateX(0) rotate(0deg); }
      50%{ transform: translateY(-58%) translateX(-6px) rotate(10deg); }
      100%{ transform: translateY(-50%) translateX(0) rotate(0deg); }
    }

    @keyframes petalsBurst{
      0%{ transform: translateY(0) translateX(0) rotate(0deg); }
      50%{ transform: translateY(-8px) translateX(-10px) rotate(8deg); }
      100%{ transform: translateY(0) translateX(0) rotate(0deg); }
    }

    /* ç­ç´šæŒ‰éˆ• */
    .btn-club{
      background: linear-gradient(135deg, #ffe3f0, #fff7fb);
      color: #ff4f98;
      font-size: 16px;
      border: 1px solid rgba(255, 95, 162, .22);
    }
    .btn-club::before{ content:"ğŸŒ¼ "; }

    /* ä¸Šæ–¹è¿”å› */
    .btn-back{
      background: linear-gradient(135deg, #ffffff, #fff0f6);
      color: #ff4f98;
      border: 1px solid rgba(255, 95, 162, .22);
      width:100%;
      margin-bottom: 14px;
    }
    .btn-back::before{ content:"ğŸŒ· "; }

    /* å‡ºå¸­ / è«‹å‡ */
    .btn-submit{
      background: linear-gradient(135deg, #2bd38f, #baf7df);
      color: #0b4a2e;
      width:100%;
      font-size: 18px;
      border: 1px solid rgba(41, 185, 122, .25);
    }
    .btn-submit::before{ content:"ğŸŒ¸ "; }

    .btn-leave{
      background: linear-gradient(135deg, #ffb34a, #ffe1b2);
      color: #5b3200;
      width:100%;
      font-size: 18px;
      border: 1px solid rgba(255, 159, 61, .25);
    }
    .btn-leave::before{ content:"ğŸŒ¼ "; }

    .btn-danger{
      background: linear-gradient(135deg, #ffe3ea, #fff);
      color: var(--danger);
      width:100%;
      margin-top: 10px;
      border: 1px solid rgba(255, 77, 109, .35);
    }
    .btn-danger::before{ content:"ğŸŒº "; }

    .btn-outline-danger{
      background: #fff;
      color: var(--danger);
      border: 1px solid rgba(255, 77, 109, .55);
      padding: 5px 8px;
      font-size: 11px;
      border-radius: 12px;
      box-shadow: 0 8px 14px rgba(255, 77, 109, .10);
      transition: .18s;
    }
    .btn-outline-danger:hover{
      box-shadow: 0 14px 20px rgba(255, 77, 109, .16);
      transform: translateY(-1px);
    }
    .btn-outline-danger::before{ content:"ğŸ§º "; }

    /* Tabs */
    .tabs{
      display:flex;
      gap: 10px;
      margin: 10px 0 16px;
      padding: 6px;
      border-radius: 20px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(255, 210, 228, .9);
      box-shadow: 0 10px 18px rgba(255, 111, 174, .10);
    }

    .tab{
      flex:1;
      padding: 12px 10px;
      text-align:center;
      cursor:pointer;
      color: #7b6a73;
      font-weight: 900;
      border-radius: 16px;
      transition: .18s;
      position:relative;
      user-select:none;
      overflow:hidden;
    }

    /* tab å·¦å´å°èŠ± */
    .tab::before{
      content:"ğŸŒ¸";
      position:absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%) scale(.95);
      opacity:.55;
      transition: .18s;
    }

    /* tab active èƒŒæ™¯æ›´å¤¢å¹» */
    .tab.active{
      color: #ff3f92;
      background: linear-gradient(135deg, #fff0f6, #ffffff);
      box-shadow: 0 12px 20px rgba(255, 95, 162, .14);
      border: 1px solid rgba(255, 95, 162, .18);
    }

    /* tab å°èŠ±å‹•ç•« */
    .tab.active::before{
      opacity: 1;
      animation: tabBloom .9s ease-in-out infinite;
    }

    /* tab é¡å¤–é£„èŠ±ï¼ˆå³ä¸Šè§’ï¼‰ */
    .tab.active::after{
      content:"ğŸŒ¼";
      position:absolute;
      right: 12px;
      top: 8px;
      opacity:.75;
      animation: tabPetal 1.2s ease-in-out infinite;
      pointer-events:none;
    }

    @keyframes tabBloom{
      0%{ transform: translateY(-50%) rotate(0deg) scale(1); }
      50%{ transform: translateY(-58%) rotate(12deg) scale(1.18); }
      100%{ transform: translateY(-50%) rotate(0deg) scale(1); }
    }

    @keyframes tabPetal{
      0%{ transform: translateY(0px) rotate(0deg); }
      50%{ transform: translateY(-4px) rotate(8deg); }
      100%{ transform: translateY(0px) rotate(0deg); }
    }

    /* åå–®å…©æ¬„ä¿æŒä¸è®Š */
    #uncheckList, #checkedList{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }

    .student-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 10px 10px;
      border: 1px solid rgba(255, 210, 228, .9);
      background: rgba(255,255,255,.92);
      border-radius: 18px;
      font-size: 14px;
      box-shadow: 0 10px 18px rgba(255, 111, 174, .08);
      transition: .18s;
    }

    .student-row:hover{
      transform: translateY(-1px);
      box-shadow: 0 14px 22px rgba(255, 111, 174, .12);
    }

    .student-row span{
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      font-weight: 800;
      color:#4b3b43;
    }

    input[type="date"], input[type="password"]{
      width:100%;
      padding: 11px 12px;
      margin-top: 8px;
      border: 1px solid rgba(255, 210, 228, .95);
      border-radius: 16px;
      font-size: 16px;
      background: rgba(255,255,255,.85);
      outline:none;
      transition: .18s;
      box-shadow: 0 10px 18px rgba(255, 111, 174, .06);
    }

    input[type="date"]:focus, input[type="password"]:focus{
      border-color: rgba(255, 95, 162, .55);
      box-shadow: 0 0 0 5px rgba(255, 95, 162, .12);
    }

    .hidden{ display:none; }

    #status{
      text-align:center;
      margin-top: 14px;
      padding: 12px 10px;
      border-radius: 18px;
      font-weight: 900;
      min-height: 20px;
      border: 1px solid transparent;
    }

    .msg-success{
      background: rgba(43, 211, 143, .12);
      color: #0b4a2e;
      border-color: rgba(43, 211, 143, .25);
    }

    .msg-error{
      background: rgba(255, 77, 109, .10);
      color: #8a001a;
      border-color: rgba(255, 77, 109, .25);
    }

    .msg-loading{
      background: rgba(255, 180, 210, .14);
      color: #6b3b55;
      border-color: rgba(255, 180, 210, .30);
      font-style: italic;
    }

    /* å°è¢å¹•æ™‚ä¿æŒå…©æ¬„ï¼Œä½†æ›´ç·Šæ¹Š */
    @media (max-width: 430px){
      .card{ padding: 18px 14px; border-radius: 22px; }
      h2{ font-size: 22px; }
      button{ border-radius: 16px; }
      .student-row{ border-radius: 16px; }
      .tab::before{ left: 10px; }
    }
  </style>
</head>

<body>

<div class="card">
  <h2>ç­ç´šé»åç°¿</h2>

  <div id="clubSelection">
    <p style="text-align:center;font-weight:900;">è«‹é¸æ“‡ç­ç´šï¼š</p>
    <div id="clubBtns" class="btn-grid">è®€å–ä¸­...</div>
  </div>

  <div id="mainPage" class="hidden">
    <button onclick="location.reload()" class="btn-back">â† æ›´æ›ç­ç´š</button>
    <h3 id="currentClubDisp" style="text-align:center;margin:6px 0 14px;color:#ff4f98;"></h3>

    <div class="tabs">
      <div id="tab1" class="tab active" onclick="switchTab('take')">é»å/è«‹å‡</div>
      <div id="tab2" class="tab" onclick="switchTab('query')">å·²é»æŸ¥è©¢</div>
    </div>

    <div class="section">
      <label><b>ä¸Šèª²æ—¥æœŸï¼š</b></label>
      <input type="date" id="targetDate" onchange="refreshLists()">
    </div>

    <div id="takeAttendanceArea">
      <div class="section">
        <label><b>å°šæœªè™•ç†å­¸ç”Ÿï¼š</b></label>
        <div id="uncheckList"></div>
      </div>

      <div class="btn-grid">
        <button id="btnSubmit" class="btn-submit" onclick="submitMulti('submit')">å‡ºå¸­é»å</button>
        <button id="btnLeave" class="btn-leave" onclick="submitMulti('leave')">å­¸ç”Ÿè«‹å‡</button>
      </div>
    </div>

    <div id="queryAttendanceArea" class="hidden">
      <div class="section">
        <label><b>åå–®ç¢ºèª (*ç‚ºè«‹å‡)ï¼š</b></label>
        <div id="checkedList"></div>
        <button class="btn-danger" onclick="confirmDeleteAll()">åˆªé™¤æ­¤æ—¥æœŸç´€éŒ„</button>
      </div>
    </div>

    <div class="section">
      <label><b>é©—è­‰å¯†ç¢¼ï¼š</b></label>
      <input type="password" id="adminPwd" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
    </div>

    <div id="status"></div>
  </div>
</div>

<script>
  // âš ï¸ è«‹ä¿®æ”¹ç‚ºä½ çš„ GAS API URL
  const API_URL = "https://script.google.com/macros/s/AKfycbwJvOrUpg5uxZzZYH3NsLuC8lLVF93cmzY7q_pcIZp6ngZ1OnW4tNUJistATaCDLZtG/exec";
  
  let curClub = "";
  let curMode = "take"; 

  window.onload = () => {
    fetchClubs();
    document.getElementById('targetDate').value = new Date().toISOString().split('T')[0];
  };

  async function fetchClubs() {
    try {
      const r = await fetch(`${API_URL}?action=getClubList`);
      const list = await r.json();
      const div = document.getElementById('clubBtns');
      div.innerHTML = "";
      list.forEach(c => {
        let b = document.createElement('button'); 
        b.className = "btn-club";
        b.innerText = c; 
        b.onclick = () => { curClub = c; showMain(); };
        div.appendChild(b);
      });
    } catch(e) { showStatus("é€£ç·šå¤±æ•—", "error"); }
  }

  function showMain() {
    document.getElementById('clubSelection').classList.add('hidden');
    document.getElementById('mainPage').classList.remove('hidden');
    document.getElementById('currentClubDisp').innerText = "ç­ç´šï¼š" + curClub;
    refreshLists();
  }

  function switchTab(m) {
    curMode = m;
    document.getElementById('tab1').className = m === 'take' ? 'tab active' : 'tab';
    document.getElementById('tab2').className = m === 'query' ? 'tab active' : 'tab';
    document.getElementById('takeAttendanceArea').className = m === 'take' ? '' : 'hidden';
    document.getElementById('queryAttendanceArea').className = m === 'query' ? '' : 'hidden';
    clearStatus(); refreshLists();
  }

  async function refreshLists() {
    const date = document.getElementById('targetDate').value;
    if(!curClub || !date) return;
    document.getElementById('uncheckList').innerHTML = "<p style='grid-column:span 2;text-align:center;'>è¼‰å…¥ä¸­...</p>";
    document.getElementById('checkedList').innerHTML = "<p style='grid-column:span 2;text-align:center;'>è¼‰å…¥ä¸­...</p>";
    try {
      const [r1, r2] = await Promise.all([
        fetch(`${API_URL}?action=getStudents&clubName=${encodeURIComponent(curClub)}&date=${date}&mode=unchecked`),
        fetch(`${API_URL}?action=getStudents&clubName=${encodeURIComponent(curClub)}&date=${date}&mode=checked`)
      ]);
      renderList('uncheckList', await r1.json(), 'checkbox');
      renderList('checkedList', await r2.json(), 'delete');
    } catch(e) { showStatus("è®€å–å¤±æ•—", "error"); }
  }

  function renderList(id, data, type) {
    const container = document.getElementById(id);
    if (!data.length) {
      container.innerHTML = "<p style='grid-column:span 2;color:gray;text-align:center;font-size:14px;'>ç„¡è³‡æ–™</p>";
      return;
    }
    container.innerHTML = "";
    data.forEach(nameText => {
      let d = document.createElement('div'); d.className = "student-row";
      if(type === 'checkbox') {
        d.innerHTML = `<span>${nameText}</span><input type="checkbox" name="stu" value="${nameText}" style="transform:scale(1.2);">`;
      } else {
        const cleanName = nameText.replace('*', '');
        d.innerHTML = `<span>${nameText}</span><button class="btn-outline-danger" onclick="deleteSingle('${cleanName}')">åˆªé™¤</button>`;
      }
      container.appendChild(d);
    });
  }

  function showStatus(msg, type) {
    const s = document.getElementById('status'); 
    s.innerText = msg; 
    s.className = "";
    if (type === "success") s.classList.add('msg-success');
    else if (type === "error") s.classList.add('msg-error');
    else s.classList.add('msg-loading');
  }

  function clearStatus() { 
    document.getElementById('status').innerText = ""; 
    document.getElementById('status').className = ""; 
  }

  async function callPost(data) {
    const pwd = document.getElementById('adminPwd').value;
    if(!pwd) return showStatus("è«‹è¼¸å…¥é©—è­‰å¯†ç¢¼", "error");
    showStatus("è™•ç†ä¸­...", "loading");
    try {
      const r = await fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({...data, clubName: curClub, password: pwd, date: document.getElementById('targetDate').value})
      });
      const res = await r.json();
      if(res.status === 'success') {
        showStatus(res.message, "success");
        document.getElementById('adminPwd').value = "";
        setTimeout(refreshLists, 1000);
      } else showStatus(res.message, "error");
    } catch(e) { showStatus("é€£ç·šéŒ¯èª¤", "error"); }
  }

  function submitMulti(act) {
    const box = document.querySelectorAll('input[name="stu"]:checked');
    const stuList = Array.from(box).map(b => b.value);
    if(!stuList.length) return showStatus("è«‹å‹¾é¸å­¸ç”Ÿ", "error");
    callPost({ action: act, students: stuList });
  }

  function deleteSingle(name) {
    if(!document.getElementById('adminPwd').value) return showStatus("è«‹å…ˆè¼¸å…¥å¯†ç¢¼å†åˆªé™¤", "error");
    callPost({ action: 'deleteSingle', studentName: name });
  }

  function confirmDeleteAll() {
    if(!document.getElementById('adminPwd').value) return showStatus("è«‹å…ˆè¼¸å…¥å¯†ç¢¼", "error");
    if(confirm("ç¢ºå®šåˆªé™¤æ­¤æ—¥æœŸæ•´æ¬„ç´€éŒ„å—ï¼Ÿ")) callPost({ action: 'deleteAll' });
  }
</script>

</body>
</html>
